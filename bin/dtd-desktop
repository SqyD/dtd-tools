#!/bin/bash

# Will generate a modified .iso image of Ubuntu 14:04 LTS for use as a self contained training environments for use at Drupal Training Day evenets.
# Requirements:
# * 5-8 GB of storage.
dtdtools_dir="/opt/dtd-tools"

# Load common routines
source $dtdtools_dir/lib/common/dtd-common

# Load config and sources.
dtd_load_config;
dtd_load_sources;
dtd_load_targets;


dtd_remaster_prep() {
  # Create the remaster dir
  mkdir -p $dtdtools_dir/tmp/desktop/remaster
  # Copy the customization-scripts template
  cp -R $dtdtools_dir/lib/desktop/customization-scripts $dtdtools_dir/tmp/desktop/
  # Copy the dtd package into the scripts dir so it's copied into the chroot.
  cp $dtdtools_dir/var/build/tracks/dtd-tracks.tgz $dtdtools_dir/tmp/desktop/customization-scripts/
  # Copy stack and drush installer scripts.
  
  cp $dtdtools_dir/bin/dtd-stack $dtdtools_dir/tmp/desktop/customization-scripts/
  cp $dtdtools_dir/bin/dtd-drush $dtdtools_dir/tmp/desktop/customization-scripts/

}

dtd_build_desktop() {
  # Build the iso.
  dtd_remaster_prep desktop
  uck-remaster \
    $dtdtools_dir/var/sources/desktop/$dtd_src_desktop_file \
    $dtdtools_dir/tmp/desktop/customization-scripts \
    $dtdtools_dir/tmp/desktop/remaster
  mv $dtdtools_dir/tmp/desktop/remaster-new-files/livecd.iso $dtdtools_dir/var/build/desktop/$dtd_target_desktop_iso_file
}

dtd_remaster_prep
dtd_build_desktop
